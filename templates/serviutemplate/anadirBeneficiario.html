{% extends "serviutemplate/index.html" %}
{% load static %}

{% block contenido %}
<section class="hero-section bg-white">
  <nav class="navbar navbar-expand-lg">
      <div class="container-fluid bg-white shadow-box">
          <img src="{%static "logo.png" %}" alt="" class="logo" style="cursor: pointer;" onclick="window.location.href='/'">
        <div class="text-logo">
        <a class="navbar-brand" href="{% url 'dashboard' %}" style="text-decoration: none;">SERVIU</a>
        <p class="d-block mb-0" style="cursor: pointer;" onclick="window.location.href='/'">Región de Ñuble</p>
          </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
              aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-center text-center" id="navbarSupportedContent">
              <ul class="navbar-nav m-auto">
                  <li class="nav-item">
                      <a class="nav-link active" aria-current="page" href="{% url 'dashboard' %}">Dashboard</a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="/beneficiarios">Lista beneficiarios</a>
                  </li>
                     {% if user.is_staff %}
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'nlp_dashboard' %}">
                        Análisis NLP</a>
                  </li>
                  {% endif %}
              </ul>
              <div class="article-user d-flex align-items-center justify-content-center d-none d-lg-flex">
                  <img src="{%static "user.jpg" %}" alt="">
                  <div class="datos-user d-inline-block text-start">
                      <p>
                          {% if request.user.is_authenticated %}
                              {{ request.user.username }}
                              {% else %}
                              {{ "Invitado" }}    
                          {% endif %}
                      </p>
                      <p>
                          {% if request.user.is_authenticated %}
                              {{ request.user.groups.first }}
                              {% else %}
                              {{ "Usuario no encontrado" }}
                          {% endif %}
                      </p>
                  </div>
                  <div class="asd">
                  <span class="material-symbols-outlined">keyboard_arrow_down</span>
                  <div class="items-user shadow-box">
                      <ul>
                        
                              {% if request.user.is_authenticated %}
                              <form method="post" action="{% url 'admin:logout' %}">
                                  {% csrf_token %}
                                  <li>
                                  <button type="submit">Cerrar sesión</button>
                              </li>
                              </form>
                                  {% else %}
                              <form method="post" action="{% url 'admin:logout' %}">
                                  {% csrf_token %}
                                  <li>
                                      <button type="submit">Inicia sesión</button>
                                  </li>
                              </form>
                              {% endif %}
                          
                      </ul>
                  </div>
              </div>
              </div>
          </div>
      </div>
  </nav>
</section>
    <div class="container-fluid ps-0">
      <div class="row">
        <div class="col-10 content">
          <div class="steps col-9">
            <h1 class="text-center beneficiario">Añadir beneficiario</h1>
            <div class="row justify-content-center mt-4">
              <div class="col-2 text-center tab-step" onclick="showTab(1)" style="cursor: pointer;">
                <div class="step step_active" id="step-1">1</div>
                <span>Datos</span> <br />
                <span>personales</span>
              </div>
              <div class="col-2 text-center tab-step" onclick="showTab(2)" style="cursor: pointer;">
                <div class="step" id="step-2">2</div>
                <span>Decreto asociado</span>
              </div>
              <div class="col-2 text-center tab-step" onclick="showTab(3)" style="cursor: pointer;">
                <div class="step" id="step-3">3</div>
                <span>Resolución asignada</span>
              </div>
            </div>
          </div>
          <div class="col-9 actualizar_beneficiario shadow-box mb-5">
            <form method="POST" class="">
              {% csrf_token %}
              
              <!-- Tab 1: Datos personales -->
              <div id="tab-1" class="tab-content">
                <h6>Datos personales</h6>
                <div class="row">
                  <div class="col-4">
                    <div class="mb-3">
                      <label for="primer_y_segundo_nombre" class="form-label"
                        >Primer y segundo nombre</label
                      >
                      {{ form.primer_y_segundo_nombre }}
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="mb-3">
                      <label for="primer_apellido" class="form-label"
                        >Primer apellido</label
                      >
                      {{ form.primer_apellido }}
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="mb-3">
                      <label for="segundo_apellido" class="form-label"
                        >Segundo apellido</label
                      >
                      {{ form.segundo_apellido }}
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="mb-3">
                      <div class="row">
                        <div class="col-8">
                          <label for="rut" class="form-label">Rut</label>
                          {{ form.rut }}
                        </div>
                        <div class="col-3">
                          <label for="dv" class="form-label">Dv</label>
                          {{ form.dv }}
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="mb-3">
                      <label for="sexo" class="form-label">Sexo</label>
                      <div class="col-6">{{ form.sexo }}</div>
                    </div>
                  </div>
                  <hr />
                </div>
                <h6>Residencia</h6>
                <div class="row">
                  <div class="col-4">
                    <label for="comuna" class="form-label">Comuna</label>
                    {{ form.comuna }}
                  </div>
                  <div class="col-4">
                    <label for="provincia" class="form-label">Provincia</label>
                    {{ form.provincia }}
                  </div>
                </div>
                <hr />
                <div class="row">
                  <div class="col-4">
                    <label for="codigo_proyecto" class="form-label"
                      >Código proyecto</label
                    >
                    {{ form.codigo_proyecto }}
                  </div>
                  <div class="col-4">
                    <label for="nombre_grupo" class="form-label"
                      >Nombre grupo</label
                    >
                    {{ form.nombre_grupo }}
                  </div>
                </div>
              </div>
              
              <!-- Tab 2: Decreto asociado -->
              <div id="tab-2" class="tab-content" style="display: none;">
                <h6>Decreto asociado</h6>
                <div class="row">
                  <div class="col-4">
                    <div class="mb-3">
                      <label for="programa" class="form-label">Programa</label>
                      {{ form_decreto.programa }}
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="mb-3">
                      <label for="tipologia" class="form-label">Tipología</label>
                      {{ form_decreto.tipologia }}
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="mb-3">
                      <label for="tramo" class="form-label">Tramo</label>
                      {{ form_decreto.tramo }}
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Tab 3: Resolución asignada -->
              <div id="tab-3" class="tab-content" style="display: none;">
                <h6>Resolución asignada</h6>
                <div class="row">
                  <div class="col-4">
                    <div class="mb-3">
                      <label for="numero_resolucion" class="form-label">Número de resolución</label>
                      {{ form_resolucion.numero_resolucion }}
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="mb-3">
                      <label for="fecha_resolucion" class="form-label">Fecha de resolución</label>
                      {{ form_resolucion.fecha_resolucion }}
                      <small class="text-muted">Formato: DD/MM/AAAA</small>
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="mb-3">
                      <label for="seleccion" class="form-label">Selección</label>
                      {{ form_resolucion.seleccion }}
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="mb-3">
                      <label for="ano_imputacion_res_of" class="form-label">Año imputación resolución oficial</label>
                      {{ form_resolucion.ano_imputacion_res_of }}
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="row mt-100">
                <div class="col-3 text-start">
                  <a href="/beneficiarios">
                    <input
                      type="button"
                      class="btn btn-danger w-100"
                      value="Cancelar"
                    />
                  </a>
                </div>
                <div class="col-6"></div>
                <div class="col-3 text-end">
                  <input
                    type="submit"
                    class="btn btn-primary w-100"
                    value="Guardar"
                  />
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    
    <script>
    function showTab(tabNumber) {
        // Ocultar todas las pestañas
        for (let i = 1; i <= 3; i++) {
            const tab = document.getElementById('tab-' + i);
            const step = document.getElementById('step-' + i);
            if (tab) tab.style.display = 'none';
            if (step) step.classList.remove('step_active');
        }
        
        // Mostrar la pestaña seleccionada
        const selectedTab = document.getElementById('tab-' + tabNumber);
        const selectedStep = document.getElementById('step-' + tabNumber);
        if (selectedTab) selectedTab.style.display = 'block';
        if (selectedStep) selectedStep.classList.add('step_active');
    }
    
    // Inicializar mostrando la primera pestaña
    document.addEventListener('DOMContentLoaded', function() {
        showTab(1);
    });
    </script>
    
    {% endblock %}